"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9365],{3905:function(e,t,n){n.d(t,{Zo:function(){return m},kt:function(){return c}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),d=p(n),c=r,k=d["".concat(l,".").concat(c)]||d[c]||u[c]||o;return n?a.createElement(k,i(i({ref:t},m),{},{components:n})):a.createElement(k,i({ref:t},m))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},20095:function(e,t,n){n.r(t),n.d(t,{assets:function(){return m},contentTitle:function(){return l},default:function(){return c},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return u}});var a=n(87462),r=n(63366),o=(n(67294),n(3905)),i=["components"],s={sidebar_position:2,title:"Basics"},l=void 0,p={unversionedId:"cep/reference/basics",id:"cep/reference/basics",title:"Basics",description:"In this we cover basics of streams, queries, and how queries can be chained to one another. Similarly basics on sources and sink that are used to consume and publish events. Also about c8db tables aka collections that can be used to store and query events. Finally an introduction to the concept of Stream Application.",source:"@site/docs/cep/reference/basics.md",sourceDirName:"cep/reference",slug:"/cep/reference/basics",permalink:"/docs/cep/reference/basics",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/master/docs/cep/reference/basics.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Basics"},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/docs/cep/reference/overview"},next:{title:"Values & Types",permalink:"/docs/cep/reference/values-n-types"}},m={},u=[{value:"Streams &amp; Queries",id:"streams--queries",level:2},{value:"Example",id:"example",level:3},{value:"Events at each stream",id:"events-at-each-stream",level:3},{value:"Source &amp; Sink",id:"source--sink",level:2},{value:"Example",id:"example-1",level:3},{value:"Input",id:"input",level:3},{value:"Output",id:"output",level:3},{value:"Table &amp; Store",id:"table--store",level:2},{value:"Example",id:"example-2",level:3},{value:"Event at table and store",id:"event-at-table-and-store",level:3},{value:"Retrieving values from tables and stores",id:"retrieving-values-from-tables-and-stores",level:3},{value:"Stream Application",id:"stream-application",level:2},{value:"Example",id:"example-3",level:3},{value:"Input",id:"input-1",level:3},{value:"Output",id:"output-1",level:3}],d={toc:u};function c(e){var t=e.components,n=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"In this we cover basics of ",(0,o.kt)("inlineCode",{parentName:"p"},"streams"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"queries"),", and how queries can be chained to one another. Similarly basics on ",(0,o.kt)("inlineCode",{parentName:"p"},"sources")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"sink")," that are used to consume and publish events. Also about c8db ",(0,o.kt)("inlineCode",{parentName:"p"},"tables")," aka collections that can be used to store and query events. Finally an introduction to the concept of ",(0,o.kt)("inlineCode",{parentName:"p"},"Stream Application"),"."),(0,o.kt)("h2",{id:"streams--queries"},"Streams & Queries"),(0,o.kt)("p",null,"This section provides introduction to ",(0,o.kt)("inlineCode",{parentName:"p"},"streams")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"queries"),", and how multiple queries can be chained to one another."),(0,o.kt)("p",null,"There are multiple type of queries such as ",(0,o.kt)("inlineCode",{parentName:"p"},"window query"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"join query"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"pattern query"),", etc. Below example explains how ",(0,o.kt)("inlineCode",{parentName:"p"},"pass-through")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"selection queries")," work. For more info refer the ",(0,o.kt)("a",{parentName:"p",href:"/docs/cep/reference/query-guide"},"Stream Query Guide"),"."),(0,o.kt)("h3",{id:"example"},"Example"),(0,o.kt)("p",null,"Following is an example annotated with descriptive comments."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"-- Defines `InputTemperatureStream` stream to pass events having `sensorId` and `temperature` attributes of types `string` and `double`.\nCREATE STREAM InputTemperatureStream (sensorId string, temperature double);\n\n-- Optional `@info` annotation to name the query.\n@info(name = 'Pass-through')\n\n-- Query to consume events from `InputTemperatureStream`, produce new events by selecting all the attributes from the incoming events, and outputs them to `TemperatureStream`.\ninsert into TemperatureAndSensorStream\nselect *\nfrom InputTemperatureStream;\n\n@info(name = 'Simple-selection')\n\n\n-- Selects only the `temperature` attribute from events, and outputs to `TemperatureOnlyStream`.\n-- Consumes events from `TemperatureAndSensorStream`. The schema of the stream is inferred from the previous query, hence no need to be defined.\ninsert into TemperatureOnlyStream\nselect temperature\nfrom TemperatureAndSensorStream;\n")),(0,o.kt)("h3",{id:"events-at-each-stream"},"Events at each stream"),(0,o.kt)("p",null,"When an event with values ","[",(0,o.kt)("inlineCode",{parentName:"p"},"'aq-14'"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"35.4"),"]"," is sent to ",(0,o.kt)("inlineCode",{parentName:"p"},"InputTemperatureStream")," stream it will get converted and travel through the streams as below."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"InputTemperatureStream : ","[",(0,o.kt)("inlineCode",{parentName:"li"},"'aq-14'"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"35.4"),"]"),(0,o.kt)("li",{parentName:"ul"},"TemperatureAndSensorStream : ","['aq-14', ",(0,o.kt)("inlineCode",{parentName:"li"},"35.4"),"]"),(0,o.kt)("li",{parentName:"ul"},"TemperatureOnlyStream : ","[",(0,o.kt)("inlineCode",{parentName:"li"},"35.4"),"]")),(0,o.kt)("h2",{id:"source--sink"},"Source & Sink"),(0,o.kt)("p",null,"Sources and Sink are used to consume and publish events to external systems."),(0,o.kt)("p",null,"There are multiple source and sink types, but this example only explains c8db source, c8stream sink, and kafka sink. For more info refer the ",(0,o.kt)("a",{parentName:"p",href:"/docs/cep/reference/query-guide"},"Stream Query guide"),"."),(0,o.kt)("h3",{id:"example-1"},"Example"),(0,o.kt)("p",null,"This example creates a C8DB source from which a stream consumes JSON messages:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"C8DB source to consume `JSON` messages from.\nCREATE SOURCE TemperatureStream WITH (type='database', collection='TemparatureStream', collection.type=\"doc\", replication.type=\"global\", map.type='json') (sensorId string, temperature double);\n")),(0,o.kt)("p",null,"This example creates a sink to log events that arrive from a stream called ",(0,o.kt)("inlineCode",{parentName:"p"},"TemperatureOnlyStream")," with the ",(0,o.kt)("inlineCode",{parentName:"p"},"temperature")," attribute of type ",(0,o.kt)("inlineCode",{parentName:"p"},"double"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE SINK TemperatureOnlyStream WITH (type='stream', stream=\"TemperatureOnlyStream\", replication.type=\"local\", map.type='json') (temperature double);\n\n@info(name = 'Simple-selection')\ninsert into TemperatureOnlyStream\nselect temperature\nfrom TemperatureStream;\n")),(0,o.kt)("h3",{id:"input"},"Input"),(0,o.kt)("p",null,"When a JSON message is written to the collection ",(0,o.kt)("inlineCode",{parentName:"p"},"TemparatureStream"),", it will automatically get mapped to an event in the ",(0,o.kt)("inlineCode",{parentName:"p"},"TemperatureStream")," stream."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "sensorId":"aq-14",\n    "temperature":35.4\n}\n')),(0,o.kt)("p",null,"To process custom input messages, please refer the examples related to Input Data Mapping."),(0,o.kt)("h3",{id:"output"},"Output"),(0,o.kt)("p",null,"After processing, the event arriving at ",(0,o.kt)("inlineCode",{parentName:"p"},"TemperatureOnlyStream")," will be emitted via ",(0,o.kt)("inlineCode",{parentName:"p"},"c8stream")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"kafka")," sinks."),(0,o.kt)("p",null,"The message is published to ",(0,o.kt)("inlineCode",{parentName:"p"},"TemperatureOnlyStream")," as"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{"temperature":"35.4"}\n')),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"kafka")," sink maps the event to a custom JSON message as below and publishes it to the ",(0,o.kt)("inlineCode",{parentName:"p"},"temperature")," topic."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{"temp":"35.4"}\n')),(0,o.kt)("p",null,"To output messages using other message formats, pleases refer the examples related to Output Data Mapping."),(0,o.kt)("h2",{id:"table--store"},"Table & Store"),(0,o.kt)("p",null,"Provides introduction to tables and database backed stores that can be used to store events."),(0,o.kt)("h3",{id:"example-2"},"Example"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"-- Defines `TemperatureStream` stream having `sensorId` and `temperature` attributes of types `string` and `double`.\nCREATE STREAM TemperatureStream (sensorId string, temperature double);\n\n-- Defines `TemperatureLogTable` having `sensorId`, `roomNo`, and `temperature` attributes of types `string`, `string`, and `double`.\nCREATE TABLE TemperatureLogTable (sensorId string, roomNo string, temperature double);\n\n-- Defines `SensorIdInfoTable` table.\nCREATE TABLE SensorIdInfoTable (sensorId string, roomNo string);\n\n@info(name = 'Join-query')\n-- Selects `sensorId`, `roomNo`, and `temperature` attributes from stream and table, and adds events to `TemperatureLogTable`.\ninsert into TemperatureLogTable\nselect t.sensorId as sensorId, s.roomNo as roomNo, t.temperature as temperature\nfrom TemperatureStream as t join SensorIdInfoTable as s\n     on t.sensorId == s.sensorId;\n")),(0,o.kt)("h3",{id:"event-at-table-and-store"},"Event at table and store"),(0,o.kt)("p",null,"When ",(0,o.kt)("inlineCode",{parentName:"p"},"SensorIdInfoTable")," table contains a recode ","[",(0,o.kt)("inlineCode",{parentName:"p"},"'aq-14'"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"'789'"),"]",", and when an event with values ","[",(0,o.kt)("inlineCode",{parentName:"p"},"'aq-14'"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"35.4"),"]"," is sent to ",(0,o.kt)("inlineCode",{parentName:"p"},"TemperatureStream")," stream."),(0,o.kt)("p",null,"The event will get converted and added to the ",(0,o.kt)("inlineCode",{parentName:"p"},"TemperatureLogTable")," table as below."),(0,o.kt)("p",null,"[",(0,o.kt)("inlineCode",{parentName:"p"},"'aq-14'"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"'789'"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"35.4"),"]"),(0,o.kt)("h3",{id:"retrieving-values-from-tables-and-stores"},"Retrieving values from tables and stores"),(0,o.kt)("p",null,"The stored values can be retrieved by join tables and stores with the streams as in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Join-query")," depicted in the example, or using on-demand queries."),(0,o.kt)("p",null,"The data in ",(0,o.kt)("inlineCode",{parentName:"p"},"TemperatureDetailsTable")," can be retrieved via on-demand queries as below, using the ",(0,o.kt)("inlineCode",{parentName:"p"},"On Demand Query REST API"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select *\nfrom TemperatureDetailsTable\n")),(0,o.kt)("h2",{id:"stream-application"},"Stream Application"),(0,o.kt)("p",null,"Provides introduction to the concept of Stream Application."),(0,o.kt)("p",null,"Stream App provides an isolated execution environment for processing the execution logic. It can be deployed and processed independently of other Stream Apps in the system. Stream Apps can use ",(0,o.kt)("inlineCode",{parentName:"p"},"inMemory"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"c8db")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"c8stream")," sources and sinks to communicate between each other."),(0,o.kt)("h3",{id:"example-3"},"Example"),(0,o.kt)("p",null,"This example creates a C8DB source to consume events from stream applications:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE STREAM TemperatureStream (sensorId string, temperature double);\n")),(0,o.kt)("p",null,"This example creates a sink to publish events from stream applications:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE SINK TemperatureOnlyStream WITH (type='inMemory', topic='Temperature') (temperature double);\n\n@info(name = 'Simple-selection')\ninsert into TemperatureOnlyStream\nselect temperature\nfrom TemperatureStream;\n")),(0,o.kt)("h3",{id:"input-1"},"Input"),(0,o.kt)("p",null,"When an event ","[",(0,o.kt)("inlineCode",{parentName:"p"},"'aq-14'"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"35.4"),"]"," is pushed via the ",(0,o.kt)("inlineCode",{parentName:"p"},"SensorDetail")," topic of the ",(0,o.kt)("inlineCode",{parentName:"p"},"inMemory")," transport from another Stream App, the event will be consumed and mapped to the ",(0,o.kt)("inlineCode",{parentName:"p"},"TemperatureStream")," stream."),(0,o.kt)("h3",{id:"output-1"},"Output"),(0,o.kt)("p",null,"After processing, the event ","[",(0,o.kt)("inlineCode",{parentName:"p"},"35.4"),"]"," arriving at ",(0,o.kt)("inlineCode",{parentName:"p"},"TemperatureOnlyStream")," will be emitted via ",(0,o.kt)("inlineCode",{parentName:"p"},"Temperature")," topic of the ",(0,o.kt)("inlineCode",{parentName:"p"},"inMemory")," transport to other subscribed Stream Apps."))}c.isMDXComponent=!0}}]);